# 1  互联网分层架构的本质

![image-20190707182555476](/Users/hubin/typoraDocument/technical-notes/架构师之路/image-20190707182555476.png)

上图是一个典型的互联网分层架构：

- **client**：客户端层，典型调用方是browser或者APP
- **web-server**：站点应用层，实现核心业务逻辑，从下游获取数据，对上游返回html或者json
- **cache**：数据-缓存层，加速访问存储
- **db**：数据-数据库层，固化数据存储



如果实施了服务化，中间多了一个服务层，这个分层架构图可能是这样：

![image-20190707182730917](/Users/hubin/typoraDocument/technical-notes/架构师之路/image-20190707182730917.png)



**同一个层次的内部**，例如端上的APP，以及web-server，也都有进行MVC分层：

- **view层**：展现
- **control层**：逻辑
- **model层**：数据

![image-20190707182924559](/Users/hubin/typoraDocument/technical-notes/架构师之路/image-20190707182924559.png)



可以看到，每个工程师骨子里，都潜移默化的实施着分层架构。

**那么，互联网分层架构的本质究竟是什么呢？**

如果我们仔细思考会发现，不管是跨进程的分层架构，还是进程内的MVC分层，都是一个**“数据移动”**，然后**“被处理”**和**“被呈现”**的过程，归根结底一句话：互联网分层架构，是一个数据移动，处理，呈现的过程，其中**数据移动是整个过程的核心**。

![image-20190707183005890](/Users/hubin/typoraDocument/technical-notes/架构师之路/image-20190707183005890.png)

如上图所示：

数据处理和呈现要CPU计算，**CPU是固定不动的**：

- db/service/web-server都部署在固定的集群上
- 端上，不管是browser还是APP，也有固定的CPU处理

**数据是移动的**：

- 跨进程移动：数据从数据库和缓存里，转移到service层，到web-server层，到client层
- 同进程移动：数据从model层，转移到control层，转移到view层

![image-20190707183051476](/Users/hubin/typoraDocument/technical-notes/架构师之路/image-20190707183051476.png)

数据要移动，所以有两个东西很重要：

- 数据传输的格式
- 数据在各层次的形态

先看**数据传输的格式**，即协议很重要：

- service与db/cache之间，二进制协议/文本协议是数据传输的载体
- web-server与service之间，RPC的二进制协议是数据传输的载体
- client和web-server之间，http协议是数据传输的载体

 

再看**数据在各层次的形态**，以用户数据为例：

- db层，数据是以“行”为单位存在的row(uid, name, age)
- cache层，数据是以kv的形式存在的kv(uid -> User)
- service层，会把row或者kv转化为对程序友好的User对象
- web-server层，会把对程序友好的User对象转化为对http友好的json对象
- client层：最终端上拿到的是json对象

 

**结论：互联网分层架构的本质，是数据的移动。**



# 2  互联网分层架构之-DAO与服务化

